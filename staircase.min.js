(function(){window.$staircase="5.2";String.prototype.trim=function(f){var d=this,h,e=0,g=0;d+="";if(!f){h=" \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000"}else{f+="";h=f.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1")}e=d.length;for(g=0;g<e;g++){if(h.indexOf(d.charAt(g))===-1){d=d.substring(g);break}}e=d.length;for(g=e-1;g>=0;g--){if(h.indexOf(d.charAt(g))===-1){d=d.substring(0,g+1);break}}return h.indexOf(d.charAt(0))===-1?d:""};String.prototype.hash=function(g){var e="",d="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789<>!:;,.$";g=g?g:8;for(var f=0;f<g;f++){e+=d.charAt(Math.floor(Math.random()*d.length))}return e};Number.prototype.toDate=function a(j){var p,i,l="Sun Mon Tues Wednes Thurs Fri Satur January February March April May June July August September October November December".split(" "),n=/\\?(.?)/gi,m=function(d,e){return i[d]?i[d]():e},o=function(d,e){for(d=String(d);d.length<e;){d="0"+d}return d};i={d:function(){return o(i.j(),2)},D:function(){return i.l().slice(0,3)},j:function(){return p.getDate()},l:function(){return l[i.w()]+"day"},N:function(){return i.w()||7},S:function(){var d=i.j(),e=d%10;3>=e&&1==parseInt(d%100/10,10)&&(e=0);return["st","nd","rd"][e-1]||"th"},w:function(){return p.getDay()},z:function(){var d=new Date(i.Y(),i.n()-1,i.j()),e=new Date(i.Y(),0,1);return Math.round((d-e)/86400000)},W:function(){var d=new Date(i.Y(),i.n()-1,i.j()-i.N()+3),e=new Date(d.getFullYear(),0,4);return o(1+Math.round((d-e)/86400000/7),2)},F:function(){return l[6+i.n()]},m:function(){return o(i.n(),2)},M:function(){return i.F().slice(0,3)},n:function(){return p.getMonth()+1},t:function(){return(new Date(i.Y(),i.n(),0)).getDate()},L:function(){var d=i.Y();return 0===d%4&0!==d%100|0===d%400},o:function(){var d=i.n(),e=i.W();return i.Y()+(12===d&&9>e?1:1===d&&9<e?-1:0)},Y:function(){return p.getFullYear()},y:function(){return i.Y().toString().slice(-2)},a:function(){return 11<p.getHours()?"pm":"am"},A:function(){return i.a().toUpperCase()},B:function(){var d=3600*p.getUTCHours(),g=60*p.getUTCMinutes(),e=p.getUTCSeconds();return o(Math.floor((d+g+e+3600)/86.4)%1000,3)},g:function(){return i.G()%12||12},G:function(){return p.getHours()},h:function(){return o(i.g(),2)},H:function(){return o(i.G(),2)},i:function(){return o(p.getMinutes(),2)},s:function(){return o(p.getSeconds(),2)},u:function(){return o(1000*p.getMilliseconds(),6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var f=new Date(i.Y(),0),k=Date.UTC(i.Y(),0),h=new Date(i.Y(),6),g=Date.UTC(i.Y(),6);return f-k!==h-g?1:0},O:function(){var d=p.getTimezoneOffset(),e=Math.abs(d);return(0<d?"-":"+")+o(100*Math.floor(e/60)+e%60,4)},P:function(){var d=i.O();return d.substr(0,3)+":"+d.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-p.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(n,m)},r:function(){return"D, d M Y H:i:s O".replace(n,m)},U:function(){return p/1000|0}};return function(d,e){p=void 0===e?new Date:e instanceof Date?new Date(e):new Date(1000*e);return d.replace(n,m)}(j,this)};try{window.location.param=function(f,e){if(!e){var e=window.location.search}var d=RegExp("[?&](?:amp;)?"+(f.replace(/(\[|\]|\{|\}|\?|\/|\\|\||\(|\))/g,"\\$1"))+"=([^&]*)").exec(e);return d&&decodeURIComponent(d[1].replace(/\+/g," "))};Object.defineProperty(window.location,"params",{set:function(){},get:function(){var e={},d=window.location.search.substr(1).split("&");if(d){for(var f in d){d[f]=d[f].replace(/^(?:amp;)?([^=]+)=(.*)?$/,"$1\n$2").split("\n");if(e[d[f][0]]){e[d[f][0]]=[e[d[f][0]]];e[d[f][0]].push(d[f][1])}else{e[d[f][0]]=d[f][1]}}}return e}})}catch(b){if(window.console){console.error("Your browser does not support changes to window.location.",b)}}window.jQuery.fn.staircase=function(d){var e=window.jQuery;if(e(this).length==1&&e(this).data("staircase")){return e(this).data("staircase")}else{return e(this).each(function(){if(!e(this).data("staircase")){e(this).data("staircase",new Staircase(this,d?d:{}))}})}};window.jQuery("input[staircase-value]").each(function(){var e=window.jQuery,d=e(this).attr("staircase-value").replace(/#{(.*?)}/g,function(f,j){if(j.match(/^date\.(.*)$/i)){return(new Date/1000).toDate(j.replace(/^date\.(.*)$/i,"$1"))}else{if(j.match(/^cookies?\.(.*)$/i)){var h=j.replace(/^cookies?\.(.*)$/i,"$1"),k=document.cookie.split("; ");for(var g in k){if(k[g].split("=")[0]==h){return k[g].substr(h.length+1)}}return""}else{var l=window;j=j.split(".");for(var g in j){if(l[j[g]]){l=l[j[g]]}else{return undefined}}if(l!=window){return l}}}});e(this).removeAttr("staircase-value").val(d)});if(!document.title||document.title.match(/\.(html?|php)$/i)||$("title").length==0){var c=$("h1, h2, h3, h4, h5, h6").first().text();if(!c){c=$("img[alt]").first().attr("alt")}if(!c){c=($("p").first().text().trim()||"").split(" ").slice(0,4).join(" ")}if(!c){c=($("body").text().trim()||"").split(" ").slice(0,4).join(" ")}if(!c){c=window.location.href.replace(/^(?:f|ht)tps?:\/\/(.*?)\.((com?|org|net|gov|edu)(\.uk)?|info)(\/(.*)?)?$/i,"$1").replace(/(-|\.|)/g," ").replace(/(^| )([a-z])/g,function(e,f,d){return f+(d.toUpperCase())})}if(!c){c=window.location.pathname.substr(1)}document.title=c}window.Data8API=function(f){var e=this,d=false;e.APIKey=f;e.Cache={};e.DefaultCountry="GB";e.Verify=function(i,h,k){if(!k&&h&&typeof h=="function"){k=h;h="email"}if(!k||typeof k!="function"){return e}if(e.Cache[h]&&e.Cache[h][i]){k.call(e.Cache[h][i],e.Cache[h][i].IsValid);return e}var j=function(l,m){e.Cache[h][i]=l;e.Cache[h][i].IsValid=!!m;k.call(e.Cache[h][i],e.Cache[h][i].IsValid)};if(!e.Cache[h]){e.Cache[h]={}}if(e.Cache[h][i]!==undefined){return e}e.Cache[h][i]="loading";switch(String(h).trim().toLowerCase()){case"telephone":case"phone":var g=new data8.internationaltelephonevalidation();g.isvalid(i,e.DefaultCountry,[new data8.option("UseMobileValidation","true"),new data8.option("UseLineValidation","true")],function(l){j.call(this,l,l.Result.ValidationResult=="Valid")});break;default:var g=new data8.emailvalidation();g.isvalid(i,"Address",null,function(l){j.call(this,l,l.Result=="Valid")});break}return e};e.Authenticate=function(i){if(!i||typeof i!="function"){return e}var h=function(){if(window.data8&&window.data8.emailvalidation&&window.data8.internationaltelephonevalidation){i.call(e)}else{setTimeout(h,50)}};if(d){return h(),e}d=true;var g=$(document.createElement("script")).appendTo("head")[0];g.onload=function(){data8.load("EmailValidation");data8.load("InternationalTelephoneValidation");h()};g.src="http://webservices.data-8.co.uk/javascript/loader.ashx?key="+e.APIKey;return e}};window.BriteVerify=function(e){var d=this;d.APIKey=e;d.Verify=function(f,g){if(f&&typeof f=="string"&&g&&typeof g=="function"){$.ajax({data:{address:f,apikey:d.APIKey},dataType:"json",success:function(h){if(h&&typeof h=="object"&&!h.errors){g.call(window,h.status)}},type:"get",url:"http://staircase.virtuosoadvertising.co.uk/proxy/briteverify.php"})}return null};return d};window.Staircases={};window.Staircase=function(d,m){var e=window.jQuery,j=e(d),f=this,k=0,g={checkboxGroups:false,history:false,ID:"".hash(8),notifyDelay:3,steps:".step",stepBlur:null,stepFocus:null,validate:null,APIs:{briteverify:{APIKey:null,fields:'[validate="email"]',scoreFieldName:null,scoreFieldSuffix:"_bvscore"},data8:{APIKey:null}}},l=function(n){return n},i=function(p,o){for(var n in o){if(p[n]&&typeof p[n]=="object"&&typeof o[n]=="object"){p[n]=i(p[n],o[n])}else{p[n]=o[n]}}return p};if(m&&typeof m=="object"){g=i(g,m)}f.Patterns={currency:/^(-)?([^a-zA-Z0-9 ])?([0-9\,]+)(\.([0-9]{2,}))?$/,date:[/^([0-9]{1,2})(\/|-|\.|,| )([0-9]{1,2})(\/|-|\.|,| )([0-9]{2,4})$/,/^((mon|monday|tue|tues|tuesday|wed|wednesday|thu|thurs|thursday|fri|friday|sat|saturday|sun|sunday)([\s]+))?([0-9]{1,2})(st|nd|rd|th)?([\s]+)?(jan|january|feb|february|mar|march|apr|april|may|jun|june|jul|july|aug|august|sep|sept|september|oct|october|nov|november|dec|december)([\s]+)?([0-9]{2,4})$/i,/^([0-9]{2})$/,/^(1|2)([0-9]{3})$/],datepicker:/^(0?[1-9]|[12][0-9]|3[01])[\/\-](0?[1-9]|1[012])[\/\-]\d{4}$/,"default":/^(?!\s*$).+/,email:/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/,filename:/^(([^\/\\\?%\*:|"<>]+)?\.([^\/\\\?%\*:|"<>\.]+)|([^\/\\\?%\*:|"<>\.]+))$/,name:/^([ A-Za-z\.']+)$/,number:[/^-?([0-9]+)$/,/^-?([0-9]+)\.([0-9]+)$/,/^([0-9]+)$/,/^([0-9]+)\.([0-9]+)$/,/^-?([0-9]+)(\.([0-9]+))?$/],phone:[/^(\+([0-9]{1,5})|0)(?!.*(\d)\1{9,})\d{9,}$/,/^(\+([0-9]{1,5})|07)(?!.*(\d)\1{9,})\d{9,}$/,/^(\+33|0)(?!.*(\d)\1{9,})\d{9,}$/],postcode:/^(([gG][iI][rR] {0,}0[aA]{2})|((([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y]?[0-9][0-9]?)|(([a-pr-uwyzA-PR-UWYZ][0-9][a-hjkstuwA-HJKSTUW])|([a-pr-uwyzA-PR-UWYZ][a-hk-yA-HK-Y][0-9][abehmnprv-yABEHMNPRV-Y]))) {0,}[0-9][abd-hjlnp-uw-zABD-HJLNP-UW-Z]{2}))$/,time:/^([0-9]{1,2}):([0-9]{2})(:([0-9]{2}))?([\s]+)?(am|pm)?$/i,zipcode:/^(^\d{5}$)|(^\d{5}-\d{4}$)$/};f.Constraints={numbers:/^([^a-zA-Z])$/,letters:/^([^0-9])$/,symbols:/^([^0-9a-zA-Z])$/};f.$object=j;f.$current=0;f.Steps=[];e(window).on("hashchange popstate",function(){var q=/^#!\/([A-Z0-9<>\!\:\;\,\.\$]{8})\/([0-9]+)$/i;if(window.location.hash.match(/^#!?\/?$/)){for(var o in window.Staircases){window.Staircases[o].Steps[0].Focus()}}else{if(window.location.hash.match(q)){var n=window.location.hash.replace(q,"$1"),p=parseInt(window.location.hash.replace(q,"$2"));if(window.Staircases[n]&&window.Staircases[n].Steps[p]&&window.Staircases[n].Steps[p].Visited){window.Staircases[n].Steps[p].Focus()}}}e(window).scrollTop(k)});f.Extend=function(n,o){f.Patterns[n]=o;return f};f.Validate=function(n,u){if(!n){return false}n=e(n);if(!u){u=n.attr("validate")}if(u){if((u=="select"||u=="selected")&&n.is("select")){var o=n.val(),t=n.find("option").first(),r=(t.attr("value")===undefined)?t.html():t.attr("value");if(typeof o=="object"){for(var q in o){if(o[q]==r){return false}}}if(o==r){return false}return true}else{if((u=="checked"||u=="unchecked")&&(n.attr("type")=="checkbox"||n.attr("type")=="radio")){return !((u=="checked"&&!n.is(":checked"))||(u=="unchecked"&&n.is(":checked")))}var s=f.Patterns,p=(u.indexOf("[")>-1)?u.replace(/\[([0-9]+)\]/g,"\n$1").split("\n"):[u];if(s){if(p.length>1){for(var q=0;q<p.length;q++){if(s[p[q]]){s=s[p[q]]}else{break}}}else{if(typeof s[p[0]]=="object"&&!(s[p[0]] instanceof RegExp)){s=s[p[0]][0]}else{s=s[p[0]]}}if(s&&s instanceof RegExp){return !!n[0].value.match(s)}}}}if(g.validate&&typeof g.validate=="function"){return !!g.validate.call(n[0],f)}return false};f.Locate=function(n,o){return e.ajax({url:"http://staircase.virtuosoadvertising.co.uk/bin/address-lookup.php",type:"post",dataType:"json",data:{postcode:n},success:function(){if(o&&address&&typeof address=="object"&&address.county&&address.town&&address.street){address.postcode=n;o(address)}}}),f};f.To=function(n){if(n<f.$current){f.Steps[n].Focus()}else{if(f.Steps[n]&&f.Steps[f.$current].Validate()){f.Steps[n].Focus()}}return f};f.Next=function(){if(f.Steps[f.$current+1]&&f.Steps[f.$current].Validate()){f.Steps[f.$current+1].Focus()}return f};f.Prev=function(){if(f.Steps[f.$current-1]){f.Steps[f.$current-1].Focus()}return f};var h=function(){var o=e(arguments[0]),n=this,p=null;$toconstrain='input:not([type="button"], [type="submit"], [type="image"])[constrain]:not(.bypass), textarea[constrain]:not(.bypass)',$allinputs='input:not([type="button"], [type="submit"], [type="image"])[name], select[name], textarea[name]',$inputs='input:not([type="button"], [type="submit"], [type="image"])[validate]:not(.bypass), select[validate]:not(.bypass), textarea[validate]:not(.bypass)',$buttons='input[type="button"].next, input[type="button"].continue, input[type="button"].submit, input[type="submit"], button',$backbuttons='input[type="button"].prev, input[type="submit"].prev, button.prev, input[type="button"].back, input[type="submit"].back, button.back';n.$index=arguments[1];n.$object=o;n.$rules=[];Object.defineProperty(o,"Visited",{get:function(){return p},set:function(){p=(arguments[0]?arguments[0]:true)}});n.Focus=function(q){for(var r in f.Steps){f.Steps[r].Blur(q)}if(!o.is(":visible")){f.$current=n.$index;if(!o.Visited){o.Visited=new Date()}if(!q){o.trigger("focus")}o.show();var s="!/"+g.ID+"/"+n.$index;k=e(window).scrollTop();if(n.$index>0&&window.location.hash!="#"+s){location.hash=s}else{if(n.$index==0){location.hash="!/"}}}return n};n.Blur=function(q){if(o.is(":visible")){if(!q){o.trigger("blur")}o.hide()}return n};n.Validate=function(s,v){if(!s){var q=true;o.find($inputs).each(function(){if(e(this).attr("optional")){if(e(this).val()&&!n.Validate(this)){q=false}}else{if(!n.Validate(this)){q=false}}});return q}s=e(s);var u=(v!==undefined)?(!!v):(s.attr("optional")?(!s.val()||!!f.Validate(s)):!!f.Validate(s)),t=s.closest("label").length?s.closest("label"):((s.attr("id")&&e('label[for="'+s.attr("id")+'"]').length)?e('label[for="'+s.attr("id")+'"]'):false),r=e(t?t.add(s):s);if(!u){r.addClass("staircase-has-error staircase-highlight-error");r.data("notify-timeout",setTimeout(function(){r.removeClass("staircase-highlight-error")},g.notifyDelay>300?g.notifyDelay:(g.notifyDelay*1000)));return false}else{r.removeClass("staircase-has-error staircase-highlight-error");if(r.data("notify-timeout")){window.clearTimeout(r.data("notify-timeout"))}}return true};n.Condition=function(s){if(typeof s!="function"&&typeof s!="string"){return n}var r=["Staircase","Step","$"],q={};o.find('input:not([type="button"], [type="submit"], [type="image"])[name], textarea[name], select[name]').each(function(){var t=e(this).attr("name");if(q[t]){q[t]=[q[t]];q[t].push(this)}else{r.push(t);q[t]=this}});n.$rules.push({callback:(typeof s=="function")?s:new Function(r,s),inputs:q});return n};o.find($toconstrain).on("keydown",function(r){var q=e(this).attr("constrain");q=f.Constraints[q]?f.Constraints[q]:null;if(q&&!String.fromCharCode(r.keyCode>=96&&r.keyCode<=105?(r.keyCode-48):r.keyCode).match(q)){return false}});o.find($inputs).on("change blur validate",function(){var s=e(this);if(g.APIs.briteverify.APIKey&&s.filter(function(){var t=g.APIs.briteverify.fields,v=false;if(typeof t=="string"){if(t.indexOf(",")>-1){t=t.split(", ")}else{t=[t]}}t.push("*[bv-score]");for(var u in t){if(t[u].trim()){v=v?true:s.is(t[u].trim())}}return v}).length&&f.Validate(s[0],"email")){var q=s.attr("bv-score")?s.attr("bv-score"):(g.APIs.briteverify.scoreFieldName?g.APIs.briteverify.scoreFieldName:s.attr("name")+g.APIs.briteverify.scoreFieldSuffix),r=(e('input[name="'+q+'"]').length>0)?e('input[name="'+q+'"]'):s.data("briteverify-scorefield");if(!r){r=e('<input type="hidden" tabindex="-1" name="'+q+'" />').insertAfter(s).on("focus",function(){s.focus()})}s.data("briteverify-scorefield",r);new BriteVerify(g.APIs.briteverify.APIKey).Verify(s[0].value,function(t){r.val(t)})}if(s.attr("d8")&&s[0].value&&g.APIs.data8&&g.APIs.data8.APIKey){if(f.Validate(s[0])){if(!f.Data8){f.Data8=new Data8API(g.APIs.data8.APIKey)}f.Data8.Authenticate(function(){f.Data8.Verify(s.val().trim(),s.attr("d8"),function(t){if(typeof this=="object"&&this.IsValid===undefined){return}if(t){s.removeClass("bypass staircase-has-error staircase-highlight-error");n.Validate(s[0],true)}else{s.addClass("bypass staircase-has-error staircase-highlight-error");s.data("notify-timeout",setTimeout(function(){s.removeClass("staircase-highlight-error")},g.notifyDelay>300?g.notifyDelay:(g.notifyDelay*1000)));n.Validate(s[0],false)}})})}}else{n.Validate(this)}});o.find($backbuttons).not($buttons).on("click",function(){if(n.$index>0){f.Steps[n.$index-1].Focus()}return false});o.find($buttons).not($backbuttons).on("click",function(){o.find($inputs).trigger("validate");if(g.checkboxGroups){var w=(typeof g.checkboxGroups=="string")?o.find(g.checkboxGroups):((o.find(".checkbox-group").length)>0?o.find(".checkbox-group"):o);if(w.find('input:not([type="button"], [type="submit"], [type="image"]), select, textbox').length==w.find('input[type="checkbox"]').length){if(w.find('input[type="checkbox"]:checked').length==0){w.addClass("staircase-has-error staircase-highlight-error");w.data("notify-timeout",setTimeout(function(){w.removeClass("staircase-highlight-error")},g.notifyDelay>300?g.notifyDelay:(g.notifyDelay*1000)))}else{w.removeClass("staircase-has-error staircase-highlight-error");if(w.data("notify-timeout")){window.clearTimeout(w.data("notify-timeout"))}}}}if(o.hasClass("staircase-has-error")||o.find(".staircase-has-error").length>0){return false}var v=true;for(var t in n.$rules){var s=[l(f),l(n),window.jQuery];for(var r in n.$rules[t].inputs){var q=e(n.$rules[t].inputs[r]);if(q.length>1){q=q.filter(function(){return((e(this).attr("type")=="checkbox"||e(this).attr("type")=="radio")&&!e(this).is(":checked"))?false:true})}s.push((q.length>0)?(q.length>1?(function(y,x){y.each(function(){x.push(e(this)[0].value)});return x})(q,[]):q[0].value):undefined)}if(n.$rules[t].callback.apply(window,s)===false){v=false}}if(!v){return false}if(f.Steps.length>(n.$index+1)){return f.Steps[n.$index+1].Focus(),false}if(!o.closest("form").length&&window.console){console.log("%cStaircase Submit Event:","font-weight: bold; font-size: 1.2em; color: #333;");console.log("%cYou are seeing this table because no submissible <form> element was found in the DOM.","font-size: .8em;");console.log(" ");var u=[];e($allinputs).each(function(){u.push({Field:e(this).attr("name"),Value:String(this.value).trim().match(/^-?([0-9]+)(\.([0-9]+))?$/)?parseFloat(this.value):this.value,Type:(typeof this.value=="object")?"object":(String(this.value).trim().match(/^-?([0-9]+)(\.([0-9]+))$/)?"float":(String(this.value).trim().match(/^-?([0-9]+)$/)?"int":"string"))})});if(window.console.table){console.table(u,["Field","Value","Type"])}else{console.log(u)}}});o.find('script[type="staircase/condition"]').each(function(){n.Condition(e(this).html())}).remove();return n};j.find(g.steps).each(function(){f.Steps.push(new h(this,arguments[0]).Blur(true))});f.Steps[0].Focus(true);window.Staircases[g.ID]=f;return f}})();